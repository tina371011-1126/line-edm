<script>
    const LIFF_ID = "2008941488-Phn5v50S";

    async function generate() {
        const imgUrlInput = document.getElementById('imgUrl').value.trim();
        if(!imgUrlInput) return alert("請輸入圖片網址");

        const linkDiv = document.getElementById('finalLink');
        const resultArea = document.getElementById('resultArea');
        linkDiv.innerText = "⚡ 正在優化圖片比例並產生縮網址...";
        resultArea.style.display = 'block';

        // --- 優化核心：提前偵測尺寸 ---
        const img = new Image();
        img.onload = async function() {
            const w = this.width;
            const h = this.height;
            
            // 將寬高加入網址參數
            const longLink = `https://liff.line.me/${LIFF_ID}/?img=${encodeURIComponent(imgUrlInput)}&w=${w}&h=${h}`;
            
            try {
                const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longLink)}`);
                const data = await response.json();
                linkDiv.innerText = data.shorturl || longLink;
            } catch (e) {
                linkDiv.innerText = longLink;
            }
        };
        img.onerror = () => alert("圖片網址無效或不支援跨域讀取");
        img.src = imgUrlInput;
    }
    // function copyText() {
        const text = document.getElementById('finalLink').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert("連結已複製！");
        }).catch(err => {
            // 備用複製方案
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert("連結已複製！");
        });
     }
</script>
