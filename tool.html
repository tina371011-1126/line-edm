<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF EDM é€£çµç”¢ç”Ÿå™¨ (ç¸®ç¶²å€ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, "Microsoft JhengHei", sans-serif; padding: 20px; background: #f4f7f6; color: #333; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 480px; margin: auto; }
        h2 { color: #02c874; font-size: 22px; margin-top: 0; display: flex; align-items: center; gap: 10px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input { width: 100%; padding: 12px; margin: 10px 0 20px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        button { background: #02c874; color: white; border: none; padding: 14px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background: #02a862; }
        #resultArea { margin-top: 25px; display: none; background: #e8f5e9; padding: 20px; border-radius: 10px; border: 1px dashed #02c874; text-align: center; }
        .link-text { word-break: break-all; font-size: 16px; color: #1b5e20; font-weight: bold; margin-bottom: 15px; padding: 10px; background: #fff; border-radius: 5px; }
        .copy-btn { background: #333; margin-top: 10px; }
        .loading-dots:after { content: ' .'; animation: dots 1s steps(5, end) infinite;}
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸš€ EDM é€£çµç”¢ç”Ÿå™¨</h2>
    <p style="font-size: 14px; color: #666;">è¼¸å…¥åœ–ç‰‡ç¶²å€ï¼Œè‡ªå‹•ç”Ÿæˆã€ŒçŸ­é€£çµã€åˆ†äº«çµ¦å®¢æˆ¶ã€‚</p>
    
    <label>è²¼ä¸Šåœ–ç‰‡ç¶²å€ (JPG/PNG)ï¼š</label>
    <input type="text" id="imgUrl" placeholder="https://example.com/image.jpg">
    
    <button id="genBtn" onclick="generate()">ç”¢å‡ºçŸ­é€£çµ</button>

    <div id="resultArea">
        <label>æ‚¨çš„çŸ­ç¶²å€ï¼š</label>
        <div class="link-text" id="finalLink"></div>
        <button class="copy-btn" onclick="copy()">é»æˆ‘è¤‡è£½çŸ­ç¶²å€</button>
    </div>
</div>

<script>
    const LIFF_ID = "2008941488-Phn5v50S";

    async function generate() {
        const imgInput = document.getElementById('imgUrl').value.trim();
        const genBtn = document.getElementById('genBtn');
        const linkDiv = document.getElementById('finalLink');
        const resultArea = document.getElementById('resultArea');

        if(!imgInput) return alert("è«‹è²¼ä¸Šåœ–ç‰‡ç¶²å€");

        // 1. æº–å‚™åŸå§‹é•·ç¶²å€
        const longLink = `https://liff.line.me/${LIFF_ID}/#img=${encodeURIComponent(imgInput)}`;
        
        // 2. é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹
        genBtn.disabled = true;
        genBtn.innerText = "æ­£åœ¨ç¸®çŸ­ç¶²å€...";
        resultArea.style.display = 'block';
        linkDiv.innerHTML = '<span class="loading-dots">è™•ç†ä¸­</span>';

        try {
            // 3. å‘¼å« is.gd å…è²» API (ä¸éœ€ Key)
            // ä½¿ç”¨ cors-anywhere æˆ–ç›´æ¥å‘¼å«ï¼ˆis.gd æ”¯æ´è·¨åŸŸï¼‰
            const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longLink)}`);
            const data = await response.json();
            
            if (data.shorturl) {
                linkDiv.innerText = data.shorturl;
            } else {
                throw new Error("API é™åˆ¶");
            }
        } catch (e) {
            // 4. å¦‚æœ API å¤±æ•—ï¼Œé€€è€Œæ±‚å…¶æ¬¡é¡¯ç¤ºåŸé•·ç¶²å€
            console.error("ç¸®ç¶²å€å¤±æ•—:", e);
            linkDiv.innerText = longLink;
            alert("ç¸®ç¶²å€æœå‹™æš«æ™‚å¿™ç¢Œï¼Œå·²é¡¯ç¤ºåŸå§‹é•·ç¶²å€");
        } finally {
            genBtn.disabled = false;
            genBtn.innerText = "ç”¢å‡ºçŸ­é€£çµ";
        }
    }

    function copy() {
        const text = document.getElementById('finalLink').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert("é€£çµå·²è¤‡è£½ï¼Œå¯ä»¥å» LINE ç™¼é€å›‰ï¼");
        });
    }
</script>

</body>
</html>
