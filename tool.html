async function fastGenerate() {
        const btn = document.getElementById('genBtn'); 
        btn.disabled = true; 
        btn.innerText = "â³ è™•ç†ä¸­...";
        
        // ç”¢ç”Ÿè¨ªå®¢ ID
        let myVid = localStorage.getItem('v_id');
        if(!myVid) {
            myVid = 'U-' + Math.random().toString(36).substr(2,6).toUpperCase();
            localStorage.setItem('v_id', myVid);
        }

        try {
            const base64 = canvas.toDataURL('image/jpeg', 0.8);
            const fd = new FormData();
            fd.append("file", base64); 
            fd.append("upload_preset", UPLOAD_PRESET);
            
            // ä¸Šå‚³åˆ° Cloudinary
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: "POST", body: fd });
            const data = await res.json();
            
            if (data.public_id) {
                // ã€æ ¸å¿ƒä¿®æ­£ã€‘åœ¨ç¶²å€ä¸­é–“å¼·åˆ¶åŠ å…¥ /index.html
                // èˆŠå¯«æ³•ï¼šhttps://liff.line.me/ID?id=... (æœƒè¢«åƒåƒæ•¸)
                // æ–°å¯«æ³•ï¼šhttps://liff.line.me/ID/index.html?id=... (åƒæ•¸å®‰å…¨)
                const shareUrl = `https://liff.line.me/${LIFF_ID}/index.html?id=${encodeURIComponent(data.public_id)}&from_vid=${myVid}`;
                
                const finalMsg = `ğŸ”” é€ä½ ä¸€å¼µæ—©å®‰ç¥ç¦ï¼š${shareUrl}`;
                document.getElementById('hiddenText').value = finalMsg;

                // GA4 è¿½è¹¤
                gtag('event', 'share_generated', { 'image_id': data.public_id, 'vid': myVid });

                if (await copyToClipboard(finalMsg)) {
                    document.getElementById('successMsg').style.display = 'block';
                    btn.innerText = "âœ¨ é€£çµå·²è¤‡è£½";
                } else {
                    document.getElementById('manualArea').style.display = 'block';
                    btn.innerText = "å®Œæˆ";
                }
            } else { 
                throw new Error("No Public ID");
            }
        } catch (e) { 
            alert("ä¸Šå‚³å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦"); 
            console.error(e);
            btn.innerText = "âŒ å¤±æ•—";
        }
        btn.disabled = false;
    }
