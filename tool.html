async function generate() {
    const img = document.getElementById('imgUrl').value.trim();
    if(!img) return alert("請輸入網址");

    const longLink = `https://liff.line.me/${LIFF_ID}/#img=${encodeURIComponent(img)}`;
    const resultArea = document.getElementById('resultArea');
    const linkDiv = document.getElementById('finalLink');
    
    linkDiv.innerText = "縮網址產生中...";
    resultArea.style.display = 'block';

    try {
        // 使用 is.gd 免費 API 縮短網址
        const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longLink)}`);
        const data = await response.json();
        
        if (data.shorturl) {
            linkDiv.innerText = data.shorturl; // 顯示短網址
        } else {
            linkDiv.innerText = longLink; // 若縮址失敗則顯示原長網址
        }
    } catch (e) {
        linkDiv.innerText = longLink; // 網路錯誤時顯示原網址
    }
}
