<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF é€£çµç”¢ç”Ÿå™¨ v3</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        h2 { color: #02c874; text-align: center; margin-bottom: 10px; font-size: 22px; }
        p { font-size: 13px; color: #666; line-height: 1.6; }
        .input-group { margin-top: 20px; }
        input { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 14px; outline: none; transition: 0.3s; }
        input:focus { border-color: #02c874; box-shadow: 0 0 0 3px rgba(2,200,116,0.1); }
        button { background: #02c874; color: white; border: none; padding: 14px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 16px; }
        button:active { transform: scale(0.98); }
        .result-area { margin-top: 25px; display: none; animation: fadeIn 0.5s; }
        .link-label { font-size: 12px; font-weight: bold; color: #333; margin-bottom: 5px; display: block; }
        .link-box { background: #f8f9fa; padding: 12px; border-radius: 8px; border: 1px solid #eee; word-break: break-all; font-size: 13px; font-family: monospace; margin-bottom: 10px; position: relative; }
        .copy-btn { background: #333; color: white; padding: 6px 12px; font-size: 12px; border-radius: 6px; cursor: pointer; border: none; width: auto; margin-top: 0; margin-left: 5px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“¸ åˆ†äº«é€£çµç”¢ç”Ÿå™¨</h2>
    <p>è¼¸å…¥åœ–ç‰‡ç¶²å€ï¼Œç”¢å‡ºèƒ½ã€Œå¼·åˆ¶é–‹å•Ÿ LINEã€çš„åˆ†äº«é€£çµã€‚å»ºè­°ä½¿ç”¨ç¸®ç¶²å€ç‰ˆä»¥ä¿æŒè¨Šæ¯æ•´æ½”ã€‚</p>

    <div class="input-group">
        <input type="url" id="imgUrl" placeholder="è«‹è²¼ä¸Šåœ–ç‰‡ç¶²å€ (https://...)" inputmode="url">
        <button id="genBtn" onclick="generate()">ç”¢ç”Ÿé€£çµ</button>
    </div>

    <div id="resultArea" class="result-area">
        <span class="link-label">âœ¨ ç¸®ç¶²å€ç‰ˆ (æ¨è–¦ï¼Œè‡ªå‹•å–šèµ· LINE):</span>
        <div class="link-box">
            <span id="shortLink">â³ è™•ç†ä¸­...</span>
            <button class="copy-btn" onclick="copyText('shortLink')">è¤‡è£½</button>
        </div>

        <span class="link-label">ğŸ”— å¼·åˆ¶å”è­°ç‰ˆ (line:// æ ¼å¼):</span>
        <div class="link-box">
            <span id="deepLink">---</span>
            <button class="copy-btn" onclick="copyText('deepLink')">è¤‡è£½</button>
        </div>
    </div>
</div>

<script>
    const LIFF_ID = "2008941488-Phn5v50S";

    async function generate() {
        const url = document.getElementById('imgUrl').value.trim();
        if(!url) return alert("è«‹è¼¸å…¥ç¶²å€");

        const btn = document.getElementById('genBtn');
        const resArea = document.getElementById('resultArea');
        btn.disabled = true;
        btn.innerText = "åˆ†æåœ–ç‰‡ä¸­...";
        resArea.style.display = 'block';

        // é è¨­å¯¬é«˜
        let w = 800, h = 800;

        // å˜—è©¦æŠ“å–åœ–ç‰‡å¯¬é«˜
        const img = new Image();
        img.onload = async function() {
            w = this.width;
            h = this.height;
            await buildLinks(url, w, h);
        };
        img.onerror = async function() {
            await buildLinks(url, w, h);
        };
        img.src = url;
    }

    async function buildLinks(url, w, h) {
        const encodedUrl = encodeURIComponent(url);
        // æ¨™æº– LIFF ç¶²å€ (ç¸®çŸ­åƒæ•¸å)
        const liffLink = `https://liff.line.me/${LIFF_ID}/?i=${encodedUrl}&w=${w}&h=${h}`;
        // å¼·åˆ¶å–šå›ç¶²å€
        const lineLink = `line://app/${LIFF_ID}/?i=${encodedUrl}&w=${w}&h=${h}`;

        document.getElementById('deepLink').innerText = lineLink;
        document.getElementById('shortLink').innerText = "æ­£åœ¨ç¸®çŸ­...";

        try {
            // ä½¿ç”¨ is.gd ç¸®ç¶²å€
            const proxy = 'https://corsproxy.io/?';
            const api = `https://is.gd/create.php?format=json&url=${encodeURIComponent(liffLink)}`;
            const response = await fetch(proxy + encodeURIComponent(api));
            const data = await response.json();
            
            document.getElementById('shortLink').innerText = data.shorturl || liffLink;
        } catch (e) {
            document.getElementById('shortLink').innerText = liffLink;
        } finally {
            const btn = document.getElementById('genBtn');
            btn.disabled = false;
            btn.innerText = "ç”¢ç”Ÿé€£çµ";
        }
    }

    function copyText(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
        });
    }
</script>

</body>
</html>
