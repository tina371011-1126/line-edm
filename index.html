<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> </title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="background:#ffffff;">
    <script>
        const LIFF_ID = "2008941488-Phn5v50S";

        async function init() {
            try {
                await liff.init({ liffId: LIFF_ID });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                liff.ready.then(async () => {
                    const urlParams = new URLSearchParams(window.location.search);
                    const imgUrl = urlParams.get('i');

                    if (imgUrl) {
                        const decodedImg = decodeURIComponent(imgUrl);
                        const img = new Image();
                        img.src = decodedImg;

                        img.onload = async () => {
                            const ratio = `${img.width}:${img.height}`;
                            const shareLink = `https://liff.line.me/${LIFF_ID}?i=${encodeURIComponent(decodedImg)}`;

                            // 執行分享好友畫面
                            await liff.shareTargetPicker([{
                                "type": "flex",
                                "altText": "您收到一張圖片",
                                "contents": {
                                    "type": "bubble",
                                    "size": "giga",
                                    "body": {
                                        "type": "box",
                                        "layout": "vertical",
                                        "contents": [{
                                            "type": "image",
                                            "url": decodedImg,
                                            "size": "full",
                                            "aspectMode": "cover",
                                            "aspectRatio": ratio,
                                            "action": { "type": "uri", "uri": shareLink }
                                        }],
                                        "paddingAll": "0px"
                                    }
                                }
                            }]);
                            liff.closeWindow();
                        };
                    } else {
                        liff.closeWindow();
                    }
                });
            } catch (e) {
                liff.closeWindow();
            }
        }
        init();
    </script>
</body>
</html>
