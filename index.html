<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MQ0WMMRZH5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MQ0WMMRZH5');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¾†è‡ªå¥½å‹çš„ç¥ç¦</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; display: flex; align-items: center; justify-content: center; font-family: sans-serif; }
        #mainContainer { position: relative; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        #previewImg { max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        .btn-share { position: absolute; bottom: 8%; width: 75%; max-width: 280px; padding: 16px; border-radius: 50px; border: none; background: linear-gradient(135deg, #62be36, #3672d9); color: white; font-size: 18px; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.5); cursor: pointer; display: none; z-index: 10; }
        .loader { width: 45px; height: 45px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #62be36; border-radius: 50%; animation: spin 1s linear infinite; }
        #errMsg { color: #666; font-size: 14px; text-align: center; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="mainContainer">
        <div id="loader" class="loader"></div>
        <div id="errMsg">âš ï¸ æ‰¾ä¸åˆ°åœ–ç‰‡ç·¨è™Ÿï¼Œè«‹é‡æ–°é»æ“Šé€£çµ</div>
        <img id="previewImg" alt="æ—©å®‰åœ–">
        <button id="shareBtn" class="btn-share" onclick="doShare()">ğŸ è½‰å‚³é€™ä»½ç¥ç¦</button>
    </div>

<script>
    const CLOUD_NAME = "dwdkxs8ot";

    // ã€æœ€å¼·è§£æå™¨ã€‘ä¸è«–åƒæ•¸åœ¨ ? é‚„æ˜¯ # é‚„æ˜¯è·³è½‰å¾Œï¼Œéƒ½èƒ½æŠ“åˆ°
    function getParam(name) {
        const fullUrl = window.location.href;
        const reg = new RegExp('[?&]' + name + '=([^&#]*)', 'i');
        const match = fullUrl.match(reg);
        return match ? match[1] : null;
    }

    const imgId = getParam('id');
    const fromVid = getParam('from_vid') || 'ORIGIN';
    const myVid = localStorage.getItem('v_id') || ('V-' + Math.random().toString(36).substr(2,6).toUpperCase());
    localStorage.setItem('v_id', myVid);

    function init() {
        const img = document.getElementById('previewImg');
        const btn = document.getElementById('shareBtn');
        const ld = document.getElementById('loader');
        const err = document.getElementById('errMsg');

        if (!imgId) {
            ld.style.display = 'none';
            err.style.display = 'block';
            return;
        }

        // ä½¿ç”¨ Cloudinary å„ªåŒ–è·¯å¾‘
        img.src = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/f_auto,q_auto/${imgId}`;
        
        img.onload = () => {
            ld.style.display = 'none';
            img.style.display = 'block';
            btn.style.display = 'block';
        };

        img.onerror = () => {
            ld.style.display = 'none';
            err.innerText = "åœ–ç‰‡å·²å¤±æ•ˆæˆ–ä¸å­˜åœ¨";
            err.style.display = 'block';
        };

        gtag('event', 'view_card', { 'image_id': imgId, 'visitor_id': myVid, 'from_vid': fromVid });
    }

    async function doShare() {
        const shareUrl = `${window.location.origin}${window.location.pathname}?id=${imgId}&from_vid=${myVid}`;
        if (navigator.share) {
            try {
                await navigator.share({ title: 'æ—©å®‰ç¥ç¦', text: 'é€ä½ ä¸€å¼µå°ˆå±¬ç¥ç¦åœ–ï¼', url: shareUrl });
                gtag('event', 'card_reshare', { 'image_id': imgId, 'vid': myVid });
            } catch (e) {}
        } else {
            navigator.clipboard.writeText(shareUrl);
            alert("é€£çµå·²è¤‡è£½ï¼Œå¿«å»è²¼çµ¦å¥½å‹ï¼");
        }
    }

    init();
</script>
</body>
</html>
