<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>正在開啟 EDM...</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <h2 id="msg" style="text-align: center; margin-top: 50%; font-family: sans-serif; color: #333;">正在讀取資訊...</h2>
    <script>
        async function main() {
            try {
                // 1. 初始化 LIFF
                await liff.init({ liffId: "2008941488-Phn5v50S" });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    // --- 追蹤與分享邏輯 ---
                    if (liff.isApiAvailable('shareTargetPicker')) {
                        const res = await liff.shareTargetPicker([
                            {
                                "type": "flex",
                                "altText": "您收到一張專屬圖片",
                                "contents": {
                                    {
  "type": "bubble",
  "hero": {
    "type": "image",
    "url": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_wEmp9REFby6o2cCIVgnzgnQP8OLqNMwEpg&s",
    "size": "full",
    "aspectRatio": "20:13",
    "aspectMode": "cover",
    "action": {
      "type": "uri",
      "uri": "https://liff.line.me/2008941488-Phn5v50S"
    }
  }
}
                                }
                            }
                        ]);
                        if (res) { console.log("分享視窗已關閉"); }
                    }
                    liff.closeWindow(); 
                }
            } catch (error) {
                document.getElementById("msg").innerText = "發生錯誤：" + error.message;
            }
        }
        main();
    </script>
</body>
</html>
